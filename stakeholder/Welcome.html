{{ block title }}Welcome{{ endblock }}
{{ block content }}

<div class="card mb-3">
    <div class="card-body">
        <p class="card-text mb-4">Please read the following information carefully before proceeding.</p>
        
        <div class="form-group mb-4">
            <ul class="list-unstyled">
                <li class="mb-2">• In this study, we will ask you to conduct a task, which will take about 10 minutes to complete.</li>
                <li class="mb-2">• There is no psychological discomfort, no physical discomfort, nor any deception in this study.</li>
                <li class="mb-2">• Your decisions and answers will only be used in anonymous form. We will not store any personally identifying information.</li>
                <li class="mb-2">• Your anonymized data will be used for academic purposes and may be shared with other academics for research purposes.</li>
                <li class="mb-2">• Participation is completely voluntary, and you can quit at any time.</li>
                <li class="mb-2">• Please note that you cannot go back to a previous screen.</li>
            </ul>
        </div>

        <div class="form-group">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="accept-conditions" name="accept">
                <label class="form-check-label" for="accept-conditions">
                    I accept the conditions and would like to continue.
                </label>
            </div>
            <div class="form-check mt-3">
                <input class="form-check-input" type="checkbox" id="decline-conditions">
                <label class="form-check-label" for="decline-conditions">
                    I don't accept the conditions and would like to return the study.
                </label>
            </div>
        </div>
        
        <!-- Hidden field for oTree form binding -->
        <div style="display: none;">
            {{ formfield 'declined_consent' }}
        </div>
    </div>
</div>

<div class="card">
    <div class="card-body text-center" id="next-button-container">
        {{ next_button }}
    </div>
</div>

{{ endblock }}

{{ block scripts }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const acceptCheckbox = document.getElementById('accept-conditions');
        const declineCheckbox = document.getElementById('decline-conditions');
        const nextButton = document.querySelector('#next-button-container button');
        const form = document.querySelector('form');
        const declineUrl = 'https://app.prolific.com/submissions/complete?cc=CS7Q1RHY';
        
        // Get the hidden oTree field
        const declinedConsentField = document.querySelector('input[name="declined_consent"]');
        
        // Initially disable the next button
        nextButton.disabled = true;
        
        // Handle accept checkbox
        acceptCheckbox.addEventListener('change', function() {
            if (this.checked) {
                declineCheckbox.checked = false;
                if (declinedConsentField) {
                    declinedConsentField.checked = false;
                }
                nextButton.disabled = false;
            } else {
                nextButton.disabled = true;
            }
        });
        
        // Handle decline checkbox - enable Next button
        declineCheckbox.addEventListener('change', function() {
            if (this.checked) {
                acceptCheckbox.checked = false;
                // Update the hidden oTree field
                if (declinedConsentField) {
                    declinedConsentField.checked = true;
                }
                nextButton.disabled = false;
            } else {
                if (declinedConsentField) {
                    declinedConsentField.checked = false;
                }
                nextButton.disabled = true;
            }
        });
        
        // Intercept form submission
        form.addEventListener('submit', function(event) {
            if (declineCheckbox.checked) {
                event.preventDefault();
                
                // Ensure the field is set
                if (declinedConsentField) {
                    declinedConsentField.checked = true;
                }
                
                // Redirect to Prolific
                window.location.href = declineUrl;
            }
            // If accept is checked, form submits normally
        });
    });
</script>
{{ endblock }}