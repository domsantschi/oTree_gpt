{{ block title }}<span style="display: none;">Consent</span>{{ endblock }}

{{ block content }}

<style>
    .consent-container {
        max-width: 800px;
        margin: 30px auto;
        padding: 25px;
        background: linear-gradient(to right, #ffffff, #f8f9fa);
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .header-section {
        text-align: center;
        margin-bottom: 30px;
    }
    
    .consent-icon {
        font-size: 48px;
        color: #007bff;
        margin-bottom: 15px;
    }
    
    .consent-list {
        border-left: 4px solid #007bff;
        padding: 20px 20px 20px 40px;
        background-color: #f8f9fa;
        margin: 20px 0;
        border-radius: 0 10px 10px 0;
    }
    
    .consent-list li {
        margin: 15px 0;
        line-height: 1.6;
        position: relative;
    }
    
    .consent-list li::before {
        content: "â€¢";
        color: #007bff;
        font-weight: bold;
        position: absolute;
        left: -20px;
    }
    
    .checkbox-container {
        background-color: #e9ecef;
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
        display: flex;
        align-items: center;
        transition: background-color 0.2s;
    }
    
    .checkbox-container:hover {
        background-color: #dee2e6;
    }
    
    .custom-checkbox {
        margin-right: 12px;
        transform: scale(1.2);
    }
    
    .checkbox-label {
        font-weight: 500;
        color: #495057;
        cursor: pointer;
    }

    .next-button-container {
        text-align: center;
        margin-top: 30px;
    }

    .next-button-container button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }
</style>

<div class="consent-container">
    <div class="header-section">
        <div class="consent-icon">ðŸ“‹</div>
        <h3>Study Participation Consent</h3>
        <p class="text-muted">Please review the following information carefully</p>
    </div>

    <ul class="consent-list">
        <li>In this study, we will ask you to conduct a task, which will take about 10 minutes to complete.</li>
        <li>There is no psychological discomfort, no physical discomfort, nor any deception in this study.</li>
        <li>Your decisions and answers will only be used in anonymous form. We will not store any personally identifying information.</li>
        <li>Your anonymized data will be used for academic purposes and may be shared with other academics for research purposes.</li>
        <li>Participation is completely voluntary, and you can quit at any time.</li>
        <li>Please note that you cannot go back to a previous screen.</li>
    </ul>

    <div class="checkbox-container">
        <input type="checkbox" id="accept-conditions" name="accept" class="custom-checkbox" />
        <label for="accept-conditions" class="checkbox-label">
            I accept the conditions and would like to continue.
        </label>
    </div>

    <div class="checkbox-container">
        <input type="checkbox" id="decline-conditions" class="custom-checkbox" />
        <label for="decline-conditions" class="checkbox-label">
            I don't accept the conditions and would like to return the study.
        </label>
    </div>
    
    <!-- Hidden field for oTree form binding -->
    <div style="display: none;">
        {{ formfield 'declined_consent' }}
    </div>

    <div class="next-button-container">
        {{ next_button }}
    </div>
</div>

{{ endblock }}

{{ block scripts }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const acceptCheckbox = document.getElementById('accept-conditions');
        const declineCheckbox = document.getElementById('decline-conditions');
        const nextButton = document.querySelector('.next-button-container button');
        const form = document.querySelector('form');
        const declineUrl = 'https://app.prolific.com/submissions/complete?cc=COV2FKG5';
        
        // Get the hidden oTree field
        const declinedConsentField = document.querySelector('input[name="declined_consent"]');
        
        // Initially disable the next button
        nextButton.disabled = true;
        nextButton.style.opacity = '0.6';
        nextButton.style.cursor = 'not-allowed';
        
        // Handle accept checkbox
        acceptCheckbox.addEventListener('change', function() {
            if (this.checked) {
                declineCheckbox.checked = false;
                nextButton.disabled = false;
                nextButton.style.opacity = '1';
                nextButton.style.cursor = 'pointer';
            } else {
                nextButton.disabled = true;
                nextButton.style.opacity = '0.6';
                nextButton.style.cursor = 'not-allowed';
            }
        });
        
        // Handle decline checkbox - enable Next button
        declineCheckbox.addEventListener('change', function() {
            if (this.checked) {
                acceptCheckbox.checked = false;
                nextButton.disabled = false;
                nextButton.style.opacity = '1';
                nextButton.style.cursor = 'pointer';
            } else {
                nextButton.disabled = true;
                nextButton.style.opacity = '0.6';
                nextButton.style.cursor = 'not-allowed';
            }
        });
        
        // Intercept form submission - ONLY set field value at submission time
        form.addEventListener('submit', function(event) {
            // Set the hidden field based on which checkbox is currently checked
            if (declineCheckbox.checked) {
                event.preventDefault();
                
                // Set the field to true (declined)
                if (declinedConsentField) {
                    declinedConsentField.checked = true;
                }
                
                // Redirect to Prolific
                window.location.href = declineUrl;
            } else if (acceptCheckbox.checked) {
                // Set the field to false (accepted) - allow form to submit normally
                if (declinedConsentField) {
                    declinedConsentField.checked = false;
                }
            }
        });
    });
</script>
{{ endblock }}