{% load static %}
{{ block title }}Your Risk Assessment of End-of-Life Care Machine{{ endblock }}
{{ block content }}
<p>
    As a production manager, you are tasked with allocating a budget of <b>100,000 dollars</b> to manage the following risks related to the development of a new healthcare technology: the End-of-Life Care Machine.
</p>
<p>
    Please distribute the funds between the two risk events below. Your allocation will reflect your strategic priorities.
</p>

<!-- Risk Events Section -->
<div style="margin-top: 30px;">
    <h5>Risk Events</h5>
    <ul>
        <li><b>Risk Event 1:</b> Regulatory challenges due to stringent healthcare compliance requirements.</li>
        <li><b>Risk Event 2:</b> High development costs leading to budget overruns.</li>
        <li><b>Risk Event 3:</b> Ethical concerns from stakeholders regarding the use of AI in end-of-life care.</li>
        <li><b>Risk Event 4:</b> Market rejection due to cultural resistance to automated healthcare solutions.</li>
    </ul>

    <!-- Budget Allocation Task -->
    <div style="margin-top: 20px;">
        <h5></p>Budget Allocation Task</h5>
        <p>You have a total budget of 100,000 dollars to manage all these risk events. How much will you allocate to each risk event?</p>
        <table style="width: 100%; border-collapse: collapse; text-align: center;">
            <thead>
                <tr style="background-color: #f2f2f2;">
                    <th>Risk Event</th>
                    <th>Allocation (USD)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Risk Event 1</td>
                    <td><input type="number" id="risk_event_1" name="risk_event_1" step="1" placeholder="0" required style="text-align: center;"></td>
                </tr>
                <tr>
                    <td>Risk Event 2</td>
                    <td><input type="number" id="risk_event_2" name="risk_event_2" step="1" placeholder="0" required style="text-align: center;"></td>
                </tr>
                <tr>
                    <td>Risk Event 3</td>
                    <td><input type="number" id="risk_event_3" name="risk_event_3" step="1" placeholder="0" required style="text-align: center;"></td>
                </tr>
                <tr>
                    <td>Risk Event 4</td>
                    <td><input type="number" id="risk_event_4" name="risk_event_4" step="1" placeholder="0" required style="text-align: center;"></td>
                </tr>
            </tbody>
        </table>
        <p><b>Total Allocation:</b> <span id="total_allocation">0</span> USD</p>
    </div>

    <!-- JavaScript for Real-Time Calculations -->
    <script>
        document.addEventListener('input', function () {
            const risk1 = parseFloat(document.getElementById('risk_event_1').value) || 0;
            const risk2 = parseFloat(document.getElementById('risk_event_2').value) || 0;
            const risk3 = parseFloat(document.getElementById('risk_event_3').value) || 0;
            const risk4 = parseFloat(document.getElementById('risk_event_4').value) || 0;

            const totalAllocation = risk1 + risk2 + risk3 + risk4;
            const totalDisplay = document.getElementById('total_allocation');
            totalDisplay.textContent = totalAllocation;
            
            // Add visual feedback
            if (totalAllocation > 100000) {
                totalDisplay.style.color = 'red';
                document.getElementById('warning').style.display = 'block';
                document.getElementById('next_button').disabled = true;
            } else {
                totalDisplay.style.color = 'black';
                document.getElementById('warning').style.display = 'none';
                document.getElementById('next_button').disabled = false;
            }
        });

        // Add validation before form submission
        document.querySelector('form').addEventListener('submit', function(e) {
            const risk1 = parseFloat(document.getElementById('risk_event_1').value) || 0;
            const risk2 = parseFloat(document.getElementById('risk_event_2').value) || 0;
            const risk3 = parseFloat(document.getElementById('risk_event_3').value) || 0;
            const risk4 = parseFloat(document.getElementById('risk_event_4').value) || 0;
            
            const totalAllocation = risk1 + risk2 + risk3 + risk4;
            if (totalAllocation > 100000) {
                e.preventDefault();
                alert('Total allocation cannot exceed 100,000 dollars.');
            }
        });
    </script>
    
    <!-- Add warning message -->
    <div id="warning" style="color: red; display: none; margin-top: 10px;">
        Warning: Total allocation exceeds the budget of 100,000 dollars!
    </div>

    <!-- Change the next button to have an id -->
    <p><button class="otree-btn-next btn btn-primary" id="next_button">Next</button></p>
{{ endblock }}